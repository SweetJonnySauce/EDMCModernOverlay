{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "EDMC Modern Overlay Payload Group Definition",
  "type": "object",
  "additionalProperties": { "$ref": "#/$defs/pluginGroup" },
  "$defs": {
    "pluginGroup": {
      "type": "object",
      "properties": {
        "matchingPrefixes": {
          "type": "array",
          "minItems": 1,
          "items": { "type": "string", "minLength": 1 }
        },
        "idPrefixGroups": {
          "type": "object",
          "minProperties": 1,
          "additionalProperties": { "$ref": "#/$defs/idPrefixGroup" }
        }
      },
      "anyOf": [
        { "required": ["matchingPrefixes"] },
        { "required": ["idPrefixGroups"] }
      ],
      "additionalProperties": false
    },
    "idPrefixGroup": {
      "type": "object",
      "properties": {
        "idPrefixes": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/idPrefixValue" }
        },
        "idPrefixGroupAnchor": {
          "type": "string",
          "enum": ["nw", "ne", "sw", "se", "center", "top", "bottom", "left", "right"]
        },
        "offsetX": {
          "type": "number"
        },
        "offsetY": {
          "type": "number"
        },
        "payloadJustification": {
          "type": "string",
          "enum": ["left", "center", "right"],
          "default": "left"
        },
        "markerLabelPosition": {
          "type": "string",
          "enum": ["below", "above", "centered"],
          "default": "below",
          "description": "Marker label placement relative to the marker."
        },
        "controllerPreviewBoxMode": {
          "type": "string",
          "enum": ["last", "max"],
          "default": "last",
          "description": "Controls controller target box selection: last visible or max transformed bounds."
        },
        "backgroundColor": {
          "oneOf": [
            {
              "type": "string",
              "pattern": "^#([0-9a-fA-F]{6}|[0-9a-fA-F]{8})$|^[A-Za-z][A-Za-z0-9_]*$"
            },
            { "type": "null" }
          ],
          "description": "Hex color in #RRGGBB or #AARRGGBB format (alpha optional), or a named color. Null clears to transparent."
        },
        "backgroundBorderColor": {
          "oneOf": [
            {
              "type": "string",
              "pattern": "^#([0-9a-fA-F]{6}|[0-9a-fA-F]{8})$|^[A-Za-z][A-Za-z0-9_]*$"
            },
            { "type": "null" }
          ],
          "description": "Border color in #RRGGBB/#AARRGGBB or named form. Null clears the border."
        },
        "backgroundBorderWidth": {
          "type": "integer",
          "minimum": 0,
          "maximum": 10,
          "description": "Border width in pixels; extends background equally on all sides."
        }
      },
      "required": ["idPrefixes"],
      "additionalProperties": false
    },
    "idPrefixValue": {
      "oneOf": [
        { "type": "string", "minLength": 1 },
        {
          "type": "object",
          "properties": {
            "value": { "type": "string", "minLength": 1 },
            "matchMode": {
              "type": "string",
              "enum": ["startswith", "exact"],
              "default": "startswith"
            }
          },
          "required": ["value"],
          "additionalProperties": false
        }
      ]
    }
  }
}
